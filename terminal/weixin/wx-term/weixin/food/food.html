<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>点餐系统sd</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link rel="stylesheet" href="../order/css/base.css">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<link rel="stylesheet" href="../order/css/weixinUi/weui.css" type="text/css">
<link href="css/Font-Awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="css/iconfont/iconfont.css" rel="stylesheet">
<script type="text/javascript" src="../order/js/Util.js"></script>
<script type="text/javascript" src="../order/js/dialog/weDialog.js"></script>
<script type="text/javascript" src="../../jquery/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="../order/js/dialog/dialog.js"></script>
<script type="text/javascript" src="../order/js/dialog/wxLoadDialog.js"></script>
<script type="text/javascript" src="food.js"></script>
<script type="text/javascript">
var createFastOrderFood = new CreateFastOrderFood({
	confirm : function(orderData){
		var tableId = Util.mp.params.tableId;
		var foods = '';
		orderData.forEach(function(element, index){
			if(index > 0){
				foods += '&';
			}
			
			if(element.selectedUnitPrice.id){
				unitId = element.selectedUnitPrice.id;
				
			}else{
				unitId = 0;
			}
				
			foods += element.food.id + ',' + element.count + ',' + unitId;
		});
		
		$.ajax({
			url : '../../WxOperateOrder.do',
			type : 'post',
			dataType : 'json',
			data : {
				dataSource : 'insertOrder',
				sessionId : Util.mp.params.sessionId,
				foods : foods,
				branchId : Util.mp.params.branchId,
				print : true,
				tableId : tableId
			},
			success : function(data, status, xhr){
				Util.lm.hide();
				if(data.success){
					//提示框设置
					var finishOrderDialog = new WeDialogPopup({
						titleText : '温馨提示',
						content : '<span style="display:block;text-align:center;">下单成功,等待服务员确认订单</span>',
						leftText : '确认',
						left : function(){
							finishOrderDialog.close();								
						},
						afterClose : function(){
							//关闭后回调
							window.location.href = 'orderList.html?sessionId=' + Util.mp.params.sessionId + "&m=" + Util.mp.oid + "&r=" + Util.mp.fid;
						}
					});
					
					finishOrderDialog.open();
						
				}else if(data.code == '7546'){
					sessionTimeout();
				}else{
					Util.showErrorMsg(data.msg);
				}
					
			},
			
			error : function(xhr, status, err){
				Util.lm.hide();
				if(err.code == '7546'){
					sessionTimeout();
				}else{
					Util.showErrorMsg(err.msg);					
				}
			}
		});
	}
	
});
createFastOrderFood.open();
</script>
</head>
<body>

</body>
</html>